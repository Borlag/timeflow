{% extends "base.html" %}
{% block content %}
  <h2>Согласования</h2>
  <div class="approvals-grid">
    <section class="surface">
      <h3>Время на согласовании</h3>
      <div class="table-wrapper">
      <table>
        <thead><tr><th>Сотрудник</th><th>Дата</th><th>Часы</th><th>Комментарий</th><th>Действия</th></tr></thead>
        <tbody>
          {% for e in pending_time %}
          <tr>
            <td>{{ e.user.full_name }}</td>
            <td>{{ e.date }}</td>
            <td>{{ '%.2f'|format(e.hours) }}</td>
            <td>{{ e.notes }}</td>
            <td>
              <div class="approval-actions">
                <form method="post" action="/admin/approve_time">
                  <input type="hidden" name="entry_id" value="{{ e.id }}">
                  <input type="hidden" name="approve" value="1">
                  <button type="submit">Одобрить</button>
                </form>
                <form method="post" action="/admin/approve_time">
                  <input type="hidden" name="entry_id" value="{{ e.id }}">
                  <input type="hidden" name="approve" value="0">
                  <button class="secondary" type="submit">Отклонить</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </section>
    <section class="surface">
      <h3>Заявки на отсутствие</h3>
      <div class="table-wrapper">
      <table>
        <thead><tr><th>Сотрудник</th><th>Период</th><th>Тип</th><th>Комментарий</th><th>Действия</th></tr></thead>
        <tbody>
          {% for r in pending_leaves %}
          <tr>
            <td>{{ r.user.full_name }}</td>
            <td>{{ r.date_from }} — {{ r.date_to }}</td>
            <td>{{ r.type|leave_type_label }}</td>
            <td>{{ r.comment }}</td>
            <td>
              <div class="approval-actions">
                <form method="post" action="/admin/approve_leave">
                  <input type="hidden" name="leave_id" value="{{ r.id }}">
                  <input type="hidden" name="approve" value="1">
                  <button type="submit">Одобрить</button>
                </form>
                <form method="post" action="/admin/approve_leave">
                  <input type="hidden" name="leave_id" value="{{ r.id }}">
                  <input type="hidden" name="approve" value="0">
                  <button class="secondary" type="submit">Отклонить</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </section>

    <section class="surface">
      <h3>Задачи на согласовании</h3>
      <div class="table-wrapper">
      <table>
        <thead><tr><th>Задача</th><th>Проект</th><th>Исполнитель</th><th>Создал</th><th>Срок</th><th>Действия</th></tr></thead>
        <tbody>
          {% for t in pending_tasks %}
          <tr>
            <td>{{ t.title }}</td>
            <td>{{ t.project.code if t.project else "—" }}</td>
            <td>{{ t.assignee.full_name }}</td>
            <td>{{ t.created_by.full_name }}</td>
            <td>{{ t.due_date or "—" }}</td>
            <td>
              <div class="approval-actions">
                <form method="post" action="/admin/approve_task">
                  <input type="hidden" name="task_id" value="{{ t.id }}">
                  <input type="hidden" name="approve" value="1">
                  <button type="submit">Одобрить</button>
                </form>
                <form method="post" action="/admin/approve_task">
                  <input type="hidden" name="task_id" value="{{ t.id }}">
                  <input type="hidden" name="approve" value="0">
                  <button class="secondary">Отклонить</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
          {% if pending_tasks|length == 0 %}
          <tr><td colspan="6" class="muted">Нет задач на согласовании</td></tr>
          {% endif %}
        </tbody>
      </table>
      </div>
    </section>
  </div>
{% endblock %}
