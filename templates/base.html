<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ app_name }} ‚Äî {{ user.full_name if user is defined else '' }}</title>
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <link rel="stylesheet" href="/static/theme.css">
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // Theme toggle
    (function() {
      const key = "tf-theme";
      const root = document.documentElement;
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      const saved = localStorage.getItem(key);
      const theme = saved || (prefersDark ? "dark" : "light");
      root.setAttribute("data-theme", theme);
      window.toggleTheme = function() {
        const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
        root.setAttribute("data-theme", next);
        localStorage.setItem(key, next);
      };
    })();
  </script>
  <style>
    /* –í—ã—Å–æ—Ç–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–ø–±–∞—Ä–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ sticky-–æ—Ç—Å—Ç—É–ø–æ–≤ (—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö) */
    :root{ --tf-topbar-h: 56px; --topbar-h: 56px; }

    /* –®–∏—Ä–æ–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã: –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –º–µ—Å—Ç–∞ */
    .table-wrapper{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .table-wrapper table{ width:100%; border-collapse:separate; border-spacing:0; }
    .sticky-table{ position: relative; }
    /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–∏–ø–∫–∞—è —à–∞–ø–∫–∞ –í–´–ö–õ–Æ–ß–ï–ù–ê ‚Äî –æ—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–∂–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ */
    .sticky-table thead th{ position: static; }

    /* –õ–∏–ø–∫–∞—è —à–∞–ø–∫–∞ —Ç–µ–ø–µ—Ä—å –í–´–ö–õ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
       –í–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –µ—Å—Ç—å –∫–ª–∞—Å—Å .stick –Ω–∞ .sticky-table */
    .sticky-table.stick thead th{
      position: sticky;
      top: var(--tf-topbar-h);
      z-index: 10;
      /* –Ω–∞–¥—ë–∂–Ω—ã–π –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω —Å –∑–∞–ø–∞—Å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º */
      background: var(--pico-card-background-color, var(--pico-background-color, #0b0f14));
      /* –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Ö–µ–¥–µ—Ä–∞ –æ—Ç —Å—Ç—Ä–æ–∫ */
      box-shadow: 0 1px 0 var(--pico-muted-border-color, rgba(255,255,255,.12));
    }
    .sticky-table.stick thead th::after{ display:none; }
    .sticky-table.stick thead{ position: relative; z-index: 10; }
    .sticky-table.stick tbody{ position: relative; z-index: 1; }
    .sticky-table thead th, .sticky-table tbody td{
      padding:.6rem .8rem; line-height:1.35; vertical-align:middle;
    }
    /* –ù–µ –¥–∞—ë–º –∫–æ–ª–æ–Ω–∫–∞–º —Å—Ö–ª–æ–ø—ã–≤–∞—Ç—å—Å—è –¥–æ –∫–∞—à–∏ */
    .sticky-table table{ min-width: min(1100px, 100%); }
    .sticky-table th, .sticky-table td{ white-space:nowrap; }
    /* –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–∑–∞–≥–æ–ª–æ–≤–æ–∫/–æ–ø–∏—Å–∞–Ω–∏–µ) –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –∏ —à–∏—Ä–µ */
    .sticky-table td:first-child, .sticky-table th:first-child{
      white-space:normal; min-width:22rem;
    }

    /* –°—Ç–µ–∫–æ–≤–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –∏–Ω–ø—É—Ç–æ–≤: –ø–æ–¥–ø–∏—Å—å –Ω–∞–¥ –∫–æ–Ω—Ç—Ä–æ–ª–æ–º (—É—Å—Ç—Ä–∞–Ω—è–µ—Ç ¬´—Å–ø–æ–ª–∑–∞–Ω–∏—è¬ª) */
    label > span{ display:block; margin-bottom:.35rem; }
    label > input, label > select, label > textarea{ width:100%; }
  </style>
</head>
<body class="layout">
  <input id="nav-toggle" type="checkbox" hidden>
  <aside class="sidebar">
    <div class="brand">
      <strong>{{ app_name }}</strong>
    </div>
    <nav class="menu">
      <a href="/dashboard">üè† –î—ç—à–±–æ—Ä–¥</a>
      <a href="/tasks?mine=1">‚úÖ –ú–æ–∏ –∑–∞–¥–∞—á–∏</a>
      <a href="/timesheet">‚è± –¢–∞–±–µ–ª—å</a>
      <a href="/leaves">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
      <a href="/team">üë• –û—Ç–¥–µ–ª</a>
      {% if user and (user.role in ['manager','admin']) %}
        <hr>
        <a href="/projects">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</a>
        <a href="/metrics">üìä –ú–µ—Ç—Ä–∏–∫–∏</a>
        <a href="/admin/approvals">üìù –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</a>
        {% if user.role == "admin" %}<a href="/admin/users">üîê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>{% endif %}
      {% endif %}
    </nav>
    <div class="sidebar-bottom">
      <button class="contrast full" onclick="toggleTheme()">üåì –¢–µ–º–∞</button>
      {% if user %}
        <small class="muted">{{ user.full_name }} ({{ user.role }})</small>
        <a href="/auth/logout" class="secondary full">–í—ã–π—Ç–∏</a>
      {% endif %}
    </div>
  </aside>

  <label class="backdrop" for="nav-toggle"></label>

  <header class="topbar">
    <label for="nav-toggle" class="burger" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">‚ò∞</label>
    <div class="spacer"></div>
  </header>

  <main class="content{% block content_class %}{% endblock %}">
    {% block content %}{% endblock %}
  </main>

  <footer class="container footer-note">
    <small>&copy; {{ org_name if org_name is defined else '' }} ‚Ä¢ {{ app_name }}</small>
  </footer>

  <script>
    // Daily 16:30 reminder
    (function() {
      if (!("Notification" in window)) return;
      if (Notification.permission !== "granted") { Notification.requestPermission(); }
      function scheduleReminder() {
        const now = new Date();
        const target = new Date();
        target.setHours(16,30,0,0);
        if (target < now) target.setDate(target.getDate()+1);
        const timeout = target - now;
        setTimeout(()=>{
          if (Notification.permission === "granted") {
            new Notification("–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ", { body: "–ü–æ—Ä–∞ –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Ä–µ–º—è –∑–∞ –≤—á–µ—Ä–∞ –∏ —á–µ–∫-–∞—É—Ç." });
          }
          scheduleReminder();
        }, timeout);
      }
      scheduleReminder();
    })();
    // Hourly gentle reminder
    (function() {
      if (!("Notification" in window)) return;
      setInterval(()=>{
        if (document.visibilityState === 'visible' && Notification.permission === "granted") {
          new Notification("TimeFlow", { body: "–û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –∏ —Ç–∞–±–µ–ª—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏." });
        }
      }, 60*60*1000);
    })();
  </script>
</body>
</html>
