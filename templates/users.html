{% extends "base.html" %}
{% block content %}
  <h2>Пользователи</h2>
  <div class="table-wrapper">
    <table>
      <thead><tr><th>Имя</th><th>Логин</th><th>Email</th><th>Отдел</th><th>Роль</th><th>Сброс пароля</th></tr></thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u.full_name }}</td>
          <td>{{ u.username }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.department }}</td>
          <td>{{ role_labels.get(u.role.value, u.role.value) }}</td>
          <td class="reset-cell">
            <form method="post" action="/admin/users/reset_password" class="inline-form reset-form">
              <input type="hidden" name="user_id" value="{{ u.id }}">
              <input type="password" name="new_password" placeholder="новый пароль" required>
              <button type="submit">Сбросить</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <hr>
  <h3>Создать пользователя</h3>
  <form method="post" action="/admin/users/new">
    <div class="grid">
      <label>Логин <input type="text" name="username" required></label>
      <label>Полное имя <input type="text" name="full_name" required></label>
    </div>
    <div class="grid">
      <label>Email <input type="email" name="email" required></label>
      <label>Отдел <input type="text" name="department"></label>
    </div>
    <div class="grid">
      <label>Роль
        <select name="role">
          {% for value, label in role_choices %}
          <option value="{{ value }}">{{ label }}</option>
          {% endfor %}
        </select>
      </label>
      <label>Пароль <input type="password" name="password" required></label>
    </div>
    <button type="submit">Создать</button>
  </form>
{% endblock %}
