/* --- UI Fix v2: burger placement & desktop backdrop off --- */
:root {
  --sidebar-w: 220px;
  --topbar-h: 52px;
  --pico-border-radius: 12px;
  --content-max-width: 1200px;
  --content-gutter: clamp(1rem, 2.2vw + 0.5rem, 3rem);
  --tf-critical: hsl(0 75% 45%);
  --tf-badge-green-bg: hsl(148 58% 88%);
  --tf-badge-green-fg: hsl(148 45% 24%);
  --tf-badge-amber-bg: hsl(40 95% 90%);
  --tf-badge-amber-fg: hsl(28 65% 28%);
  --tf-badge-red-bg: hsl(3 80% 92%);
  --tf-badge-red-fg: hsl(3 70% 35%);
  --tf-badge-blue-bg: hsl(224 90% 92%);
  --tf-badge-blue-fg: hsl(224 70% 30%);
  --tf-badge-gray-bg: hsl(210 16% 90%);
  --tf-badge-gray-fg: hsl(210 12% 30%);
}

[data-theme="dark"] {
  --tf-badge-green-bg: hsl(148 35% 18%);
  --tf-badge-green-fg: hsl(148 70% 80%);
  --tf-badge-amber-bg: hsl(40 45% 18%);
  --tf-badge-amber-fg: hsl(40 70% 80%);
  --tf-badge-red-bg: hsl(3 45% 18%);
  --tf-badge-red-fg: hsl(3 80% 80%);
  --tf-badge-blue-bg: hsl(224 45% 20%);
  --tf-badge-blue-fg: hsl(224 75% 85%);
  --tf-badge-gray-bg: hsl(210 16% 20%);
  --tf-badge-gray-fg: hsl(210 12% 80%);
}

.layout { display: contents; }

/* Sidebar */
.sidebar {
  position: fixed; inset: 0 auto 0 0; width: var(--sidebar-w);
  background: var(--pico-card-background-color);
  border-right: 1px solid var(--pico-muted-border-color);
  padding: 1rem; display: flex; flex-direction: column; gap: 1rem;
  transform: translateX(-100%); transition: transform .2s ease;
  z-index: 1000;
}
.brand { font-size: 1.05rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.menu { display: flex; flex-direction: column; gap: .25rem; }
.menu a { padding: .5rem .6rem; border-radius: 8px; }
.menu a:hover { background: color-mix(in hsl, var(--pico-primary), transparent 85%); }
.sidebar-bottom { margin-top: auto; display: grid; gap: .5rem; }
.full { width: 100%; }
.muted { color: var(--pico-muted-color); }

/* Top bar */
.topbar {
  position: fixed; top: 0; left: 0; right: 0;
  height: var(--topbar-h); display: flex; align-items: center; gap: .5rem;
  padding: 0 .75rem; background: var(--pico-background-color);
  border-bottom: 1px solid var(--pico-muted-border-color); z-index: 1100;
}
.burger { font-size: 1.25rem; cursor: pointer; user-select: none; }
.spacer { flex: 1; }

/* Content */
.content {
  padding: calc(var(--topbar-h) + 1rem) var(--content-gutter) 3rem;
  margin: 0 auto;
  width: min(100%, var(--content-max-width));
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.content.content--wide {
  width: 100%;
  max-width: none;
}

.content > * {
  margin: 0;
}

.footer-note {
  margin: 0 auto 2.5rem;
  width: min(100%, var(--content-max-width));
  padding: 0 var(--content-gutter);
}

.surface,
.content > article,
.content > table,
.content > form,
.content > details {
  background: var(--pico-card-background-color);
  border: 1px solid var(--pico-muted-border-color);
  border-radius: var(--pico-border-radius);
  padding: 1.1rem 1.35rem;
  box-shadow: 0 24px 48px -32px rgba(0, 0, 0, 0.35);
}

.surface > :last-child { margin-bottom: 0; }
.surface header { font-weight: 600; margin-bottom: .35rem; }
.surface summary { font-weight: 600; cursor: pointer; }
.surface summary::-webkit-details-marker { display: none; }
.surface summary::after {
  content: "▾";
  font-size: .85rem;
  margin-left: .5rem;
  transition: transform .2s ease;
}
.surface[open] summary::after { transform: rotate(180deg); }
.surface form { margin-top: .75rem; }
.surface form button { width: fit-content; }

.button-group {
  display: flex;
  gap: .5rem;
  flex-wrap: wrap;
  margin: .75rem 0;
}

.button-group form {
  margin: 0;
}

.button-group button {
  width: auto;
  min-width: 120px;
}

/* Sticky table headers */
.sticky-table thead th { position: sticky; top: var(--topbar-h); background: var(--pico-card-background-color); z-index: 5; }

/* Backdrop (overlay) */
.backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.25); opacity: 0; pointer-events: none; transition: opacity .2s ease; z-index: 1050; }
/* По умолчанию на десктопе оверлея нет */
@media (min-width: 992px) { .backdrop { display: none; } }
/* На мобильных показываем оверлей при открытом меню */
@media (max-width: 991px) { #nav-toggle:checked ~ .backdrop { opacity: 1; pointer-events: auto; } }

/* Desktop layout behavior */
@media (min-width: 992px) {
  /* Открыто: сайдбар виден, топбар и контент смещены вправо */
  .sidebar { transform: translateX(0); }
  .topbar { left: var(--sidebar-w); }            /* <— Бургер стоит над контентом, не над меню */
  .content, .footer-note {
    margin-left: calc(var(--sidebar-w) + var(--content-gutter));
    width: min(calc(100% - var(--sidebar-w)), var(--content-max-width));
  }

  .content.content--wide {
    width: calc(100% - var(--sidebar-w) - var(--content-gutter));
  }

  /* Закрыто: сайдбар скрыт, топбар и контент занимают всю ширину */
  #nav-toggle:checked ~ .sidebar { transform: translateX(-100%); }
  #nav-toggle:checked ~ .topbar { left: 0; }
  #nav-toggle:checked ~ .content,
  #nav-toggle:checked ~ .footer-note {
    margin-left: var(--content-gutter);
    width: min(100%, var(--content-max-width));
  }
}

/* Small screens: поведение как раньше — выезжающее меню и затемнение */
@media (max-width: 991px) {
  #nav-toggle:checked ~ .sidebar { transform: translateX(0); }
}

/* Badges */
.badge { padding: .15rem .5rem; border-radius: 999px; font-size: .75rem; line-height: 1.6; }
.status-in_progress { background: var(--tf-badge-green-bg); color: var(--tf-badge-green-fg); }
.status-on_pause   { background: var(--tf-badge-amber-bg); color: var(--tf-badge-amber-fg); }
.status-waiting    { background: var(--tf-badge-red-bg); color: var(--tf-badge-red-fg); }
.status-done       { background: var(--tf-badge-blue-bg); color: var(--tf-badge-blue-fg); }
.status-canceled   { background: var(--tf-badge-gray-bg); color: var(--tf-badge-gray-fg); }

.page-header {
  display: flex;
  flex-direction: column;
  gap: .35rem;
}

.page-header h1 {
  margin-bottom: 0;
  font-size: 1.85rem;
}

.page-header .range-chip {
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  padding: .35rem .65rem;
  border-radius: 999px;
  background: color-mix(in srgb, var(--pico-primary) 12%, transparent);
  font-size: .9rem;
  width: fit-content;
}

.grid-two {
  display: grid;
  gap: 1rem;
}

@media (min-width: 992px) {
  .grid-two { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

.section-head {
  display: flex;
  flex-wrap: wrap;
  gap: .75rem;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.segmented {
  display: inline-flex;
  border: 1px solid var(--pico-muted-border-color);
  border-radius: 999px;
  background: color-mix(in srgb, var(--pico-muted-color) 6%, transparent);
  overflow: hidden;
}

.segmented a {
  padding: .45rem 1rem;
  font-size: .9rem;
  text-decoration: none;
  color: inherit;
  transition: background .2s ease, color .2s ease;
}

.segmented a:hover { background: color-mix(in srgb, var(--pico-primary) 12%, transparent); }
.segmented a.active {
  background: var(--pico-primary);
  color: var(--pico-primary-inverse);
}

.table-wrapper {
  overflow-x: auto;
  margin: -0.25rem -0.5rem 0;
  padding: 0 .5rem;
}

.table-wrapper table {
  width: max-content;
  min-width: 100%;
  margin-bottom: 0;
}

.table-wrapper th,
.table-wrapper td {
  white-space: nowrap;
  vertical-align: top;
}

.table-wrapper td:first-child {
  min-width: 220px;
  white-space: normal;
}

.table-wrapper td.reset-cell {
  white-space: normal;
}

.table-wrapper td .badge { white-space: nowrap; }

.inline-form {
  display: inline-flex;
  gap: .5rem;
  align-items: center;
  flex-wrap: wrap;
}

.reset-form {
  gap: .4rem;
}

.inline-form input,
.inline-form select {
  min-width: 160px;
}

.reset-form input {
  min-width: 0;
  flex: 1 1 140px;
}

.reset-form button {
  flex-shrink: 0;
}

.inline-form button {
  white-space: nowrap;
}

.approvals-grid {
  display: grid;
  gap: 1.5rem;
}

@media (min-width: 768px) {
  .approvals-grid {
    grid-template-columns: repeat(auto-fit, minmax(460px, 1fr));
  }
}

@media (min-width: 1440px) {
  .approvals-grid {
    grid-template-columns: repeat(3, minmax(460px, 1fr));
  }
}

.approvals-grid section {
  display: flex;
  flex-direction: column;
  gap: .75rem;
  min-width: 0;
}

.approval-actions {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
}

.approval-actions form {
  margin: 0;
}

.metrics-grid {
  display: grid;
  gap: 1.5rem;
}

@media (min-width: 1024px) {
  .metrics-grid {
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  }
}

.chart-card {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.chart-card > header {
  display: flex;
  flex-direction: column;
  gap: .25rem;
}

.chart-card > header h2 {
  margin: 0;
  font-size: 1.2rem;
}

.chart-card canvas {
  width: 100% !important;
  height: 100% !important;
  display: block;
}

.tasks-card details[open] {
  margin-top: .5rem;
}

.tasks-card details form {
  display: grid;
  gap: .5rem;
}

.tasks-card details summary {
  font-weight: 500;
  cursor: pointer;
}

